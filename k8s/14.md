# Lab 14

## Kube prometheus stack

- Prometheus Operator: Simplifies the deployment and configuration of Prometheus and related monitoring components in Kubernetes using custom resources 1.
- Redundant Alertmanager: Having multiple Alertmanager instances for high availability and load balancing of alert notifications.
- Prometheus Node Exporter: Collects hardware and operating system metrics from nodes in a cluster.
- Kube-state-metrics: Generates metrics about the state of Kubernetes objects, providing insights into the health and status of the cluster.
- Prometheus Blackbox Exporter: Allows Prometheus to perform network probes against hosts and services, checking their availability and performance over time.
- Prometheus Adapter for Kubernetes Metrics API: Bridges Prometheus metrics with Kubernetes' autoscaling and scheduling mechanisms, enabling dynamic scaling based on custom metrics.
- Grafana: A visualization tool that integrates with Prometheus to display metrics in customizable dashboards, facilitating easier understanding and analysis of monitoring data.

## Installation of Helm Chars

### kubectl get po,sts,svc,pvc,cm :

- Displays all pods: `kubectl get po`
```shell
NAME                                                         READY   STATUS    RESTARTS   AGE
pod/alertmanager-monitoring-kube-prometheus-alertmanager-0   2/2     Running   0          46m
pod/monitoring-grafana-6113esdgse-fe64e                      3/3     Running   0          47m
pod/monitoring-kube-prometheus-operator-gkmrwfw611-9fgd5     1/1     Running   0          47m
pod/monitoring-kube-state-metrics-llrdw6893f-4er64           1/1     Running   0          47m
pod/monitoring-prometheus-node-exporter-oigre                1/1     Running   0          47m
pod/prometheus-monitoring-kube-prometheus-prometheus-0       2/2     Running   0          46m
pod/vault-0                                                  1/1     Running   4          46m
pod/vault-agent-injector-dmfkk15ww-ldfl5                     1/1     Running   4          46m
pod/my-python-app-0                                          1/1     Running   0          35s
pod/my-python-app-1                                          1/1     Running   0          35s
pod/my-python-app-2                                          1/1     Running   0          35s
```

- Displays StatefulSets: `kubectl get sts`
```shell
NAME                                                                    READY   AGE
statefulset.apps/alertmanager-monitoring-kube-prometheus-alertmanager   1/1     20m
statefulset.apps/prometheus-monitoring-kube-prometheus-prometheus       1/1     20m
statefulset.apps/vault                                                  1/1     54m
statefulset.apps/my-python-app                                          3/3     34s
```

- Shows Services available: `kubectl get svc`
```shell
NAME                                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP   46m
service/kubernetes                                ClusterIP   10.96.0.1        <none>        443/TCP                      46m
service/monitoring-grafana                        ClusterIP   10.103.79.49     <none>        80/TCP                       47m
service/monitoring-kube-prometheus-alertmanager   ClusterIP   10.109.161.202   <none>        9093/TCP,8000/TCP            47m
service/monitoring-kube-prometheus-operator       ClusterIP   10.97.108.36     <none>        443/TCP                      47m
service/monitoring-kube-prometheus-prometheus     ClusterIP   10.96.47.133     <none>        9090/TCP,8000/TCP            47m
service/monitoring-kube-state-metrics             ClusterIP   10.101.170.32    <none>        8000/TCP                     47m
service/monitoring-prometheus-node-exporter       ClusterIP   10.98.169.123    <none>        9100/TCP                     47m
service/prometheus-operated                       ClusterIP   None             <none>        9090/TCP                     46m
service/vault                                     ClusterIP   10.101.231.178   <none>        8200/TCP,8201/TCP            46m
service/vault-agent-injector-svc                  ClusterIP   10.109.243.250   <none>        443/TCP                      46m
service/vault-internal                            ClusterIP   None             <none>        8200/TCP,8201/TCP            46m
service/app-python                                ClusterIP   10.98.211.227    <none>        8000/TCP                     35s
```

- Lists Persistent Volume Claims (PVCs): `kubectl get pvc`
```shell 
NAME                                       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/data-app-python-0    Bound    pvc-ed528780-adf2-561d-sdfd-615sdfvs55df   1Gi        RWO            standard       12h
persistentvolumeclaim/data-app-python-1    Bound    pvc-sfsd54sd-dfd4-ds54-sdf4-sdfssdq941qd   1Gi        RWO            standard       11h
persistentvolumeclaim/data-app-python-2    Bound    pvc-ksmdfs26-dkks-ss94-df54-sdflfh6513ef   1Gi        RWO            standard       11h
```

## Information from Grafana Dashboards

### Check CPU and Memory consumption of your StatefulSet
- 0.007 of CPU and 46 MiB of Memory consumption

### Identify Pods with higher and lower CPU usage in the default namespace
- prometheus-monitoring-kube-prometheus-prometheus-0 is consuming 0.2 CPU usage which is the highest one.
- alertmanager-monitoring-kube-prometheus-alertmanager-0 is consuming 0.004 CPU usage which is the lowest one.

### Monitor node memory usage in percentage and megabytes
- 72.4% and 3.6 GiB memory usage

### Count the number of pods and containers managed by the Kubelet service.
- 18 Pods and 22 Containers

### Evaluate network usage of Pods in the default namespace.
- 42.4 Kb/s received and 54.7 Kb/s transmitted network usage.

### Determine the number of active alerts
- 10 Active Alerts