---
- name: Wipe docker
  block:
    - name: Stop and remove Docker containers
      command: docker-compose down
      args:
        chdir: "{{ app_dir }}"

    - name: Remove Docker volumes
      command: docker-compose down -v
      args:
        chdir: "{{ app_dir }}"

    - name: Remove Docker network
      command: docker network prune -f

    - name: Remove Docker images
      command: docker image prune -a -f

    - name: Remove compose file
      file:
        path: "{{ app_dir }}/docker-compose.yml"
        state: absent

  when: web_app_full_wipe | bool
  tags:
    - wipe

- name: Wipe nginx
  file:
    path: /etc/nginx/sites-enabled/{{ app_name }}
    state: absent
  notify: restart
  tags:
    - wipe
  when: web_app_full_wipe | bool